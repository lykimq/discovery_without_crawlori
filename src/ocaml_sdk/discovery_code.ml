open Tzfunc.Proto

let code =
  EzEncoding.destruct
    script_expr_enc.json
    {|[{"prim":"parameter","args":[{"prim":"pair","args":[{"prim":"pair","args":[{"prim":"key","annots":["%key"]},{"prim":"int","annots":["%nonce"]}]},{"prim":"signature","annots":["%signature"]},{"prim":"string","annots":["%uri"]}]}]},{"prim":"storage","args":[{"prim":"big_map","args":[{"prim":"key_hash"},{"prim":"pair","args":[{"prim":"int"},{"prim":"string"}]}]}]},{"prim":"code","args":[[{"prim":"UNPAIR"},{"prim":"DUP"},{"prim":"CAR"},{"prim":"CAR"},{"prim":"DUP"},{"prim":"HASH_KEY"},{"prim":"DUP","args":[{"int":"3"}]},{"prim":"CDR"},{"prim":"CDR"},{"prim":"DUP","args":[{"int":"4"}]},{"prim":"CAR"},{"prim":"CDR"},{"prim":"DUP","args":[{"int":"6"}]},{"prim":"DUP","args":[{"int":"4"}]},{"prim":"GET"},{"prim":"IF_NONE","args":[[],[{"prim":"CAR"},{"prim":"DUP","args":[{"int":"2"}]},{"prim":"COMPARE"},{"prim":"GT"},{"prim":"NOT"},{"prim":"IF","args":[[{"prim":"PUSH","args":[{"prim":"string"},{"string":"old nonce"}]},{"prim":"FAILWITH"}],[]]}]]},{"prim":"DUP","args":[{"int":"2"}]},{"prim":"DUP","args":[{"int":"2"}]},{"prim":"PAIR"},{"prim":"PACK"},{"prim":"DIG","args":[{"int":"5"}]},{"prim":"CDR"},{"prim":"CAR"},{"prim":"DIG","args":[{"int":"5"}]},{"prim":"CHECK_SIGNATURE"},{"prim":"NOT"},{"prim":"IF","args":[[{"prim":"PUSH","args":[{"prim":"string"},{"string":"invalid signature"}]},{"prim":"FAILWITH"}],[]]},{"prim":"DIG","args":[{"int":"3"}]},{"prim":"DUG","args":[{"int":"2"}]},{"prim":"PAIR"},{"prim":"DIG","args":[{"int":"2"}]},{"prim":"SWAP"},{"prim":"SOME"},{"prim":"SWAP"},{"prim":"UPDATE"},{"prim":"NIL","args":[{"prim":"operation"}]},{"prim":"PAIR"}]]}]|}
